# MantisBT中文使用手册（三）—— 用户管理

## 创建用户账号

在MantisBT中，可以创建无限多个用户（译者注：应该还是会受内存的限制）。一般来说，如果系统总共有数千个用户，其中比`REPORTER`（译者注：MantisBT内置角色）权限高的用户应该不会很多。

MantisBT默认只有`ADMINISTRATOR`访问级别的用户有权限创建新的用户账户，步骤如下：

- 点击主菜单上的 "管理"
- 点击 "用户"（如果默认没有选择）
- 点击下方的 "创建新账户 "按钮
- 输入用户名、电子邮件地址并选择他的全局访问级别（之后会提到这个级别）
- 其他字段是可选的
- 点击 "创建用户"

创建一个用户会触发以下动作

- 在数据库中创建一个用户
-  如果电子邮件通知，即配置文件中的`$g_enable_email_notification`，被设置为ON，那么用户将收到一封电子邮件，让他们激活账户并设置密码，同时，访问级别为`$g_notify_new_user_created_threshold_min`及以上的用户将收到一个用户账户被创建的通知。有关用户的信息，如用户名、电子邮件地址、IP地址，都包含在电子邮件通知中。否则，就会创建一个空密码的账户，且不会通知。

设置账号时，对 "保护 "选项打了勾，意味着该账户是一个共享账户（如演示账户），因此使用该账户登录的用户将不被允许改变账户偏好和个人资料信息。在`$g_anonymous_account`选项后设置的账户名都将被默认保护。当你创建匿名用户账户时，"保护 "选项基本上被忽略，因为匿名用户总是被当作受保护的用户。

## 激活与禁用账号

当一个人离开团队的时候，最好是禁用他们的账号。

如果一个账号被禁用了，那么以下操作将会被执行：

- 该账户当前所有的行为都会无效
- 无法使用这个账号登录
- 不会再有邮箱通知这个账号
- 选择“分配给”与“邮箱通知”的用户选项时将不会有这个用户名

禁用这个操作是完全可逆的，也就是这个账号可以重新被激活。激活之后就可以像之前那样使用。

## 删除用户账号

另一种禁用账户的方法是删除。这种方法只推荐给那些没有活动过的账户（即没有报告过问题）。一旦账户被删除，任何与该账户相关的问题或行动，都将与`user123`（其中123是被删除的账户的代码）相关。注意，相关的问题或行动不会被删除，只是会被转交给`user123`。

就之前提到过的数据库而言，在删除一个用户后，以用户ID为外键的记录将有一个在用户表中不再存在的值，所以之后在操作数据库的时候应该要考虑到这一点。

默认情况下，管理员是唯一可以删除用户账户的用户。他们可以通过点击管理->用户，找到要删除的用户并打开其详细信息页面，然后点击 "删除用户 "按钮来删除该用户。

注意，"删除用户 "不是一个可逆的过程。因此，如果需要重新添加用户账户，不可能重新创建用户账户，使其获得相同的ID，从而保留其历史。但是你可以通过SQL语句，在用户表中手动创建一个具有相同ID的记录，不过这种方法不推荐。

## 用户注册

如果对外开放MantisBT的话，势必需要一个注册的功能，MantisBT自然也提供了。外部用户可以注册一个账户，并默认获得一个`REPORTER`权限（可通过`$g_default_new_account_access_level`配置选项配置）。注册过程可以通过`$g_allow_signup`配置选项启用/禁用，该选项默认为启用。

如果用户注册功能要启用，那么需要将`$g_send_reset_password`也设置为ON，并正确配置电子邮件设置（见 "Email "部分）。

如果电子邮件通知`$g_enable_email_notification`设置为ON，那么访问级别为`$g_notify_new_user_created_threshold_min`及以上的用户将收到一个用户账户被创建的通知。有关用户的信息，如用户名、电子邮件地址、IP地址等，都包含在电子邮件通知中。

## 忘记密码与重置密码

用户可能经常忘记自己的密码。MantisBT提供了两种方法来处理这种情况："忘记密码 "和 "重置密码"。

"忘记密码 "是需要用户自己去弄的。用户进入登录页面，发现他们不记得自己的密码，然后点击 "丢失密码？"链接。然后，用户被要求提供他们的用户名和电子邮件地址。如果正确的话，就会向他们发送一封带有链接的电子邮件，允许他们登录MantisBT并更改密码。

"重设密码 "是用户向管理员报告说他们无法再登录MantisBT。这可能是由于忘记了他们的密码，也可能是忘记了他们注册时使用的用户名或电子邮件地址。之后管理员就去管理->用户界面去查看这个用户。在用户的详细信息界面下，有一个 "重置密码 "按钮，管理员可以点击这个按钮来重置密码，并触发一封电子邮件给用户，让他们进入MantisBT并设置密码。在电子邮件通知被禁用的情况下，重设密码将把密码设置为一个空字符串。

## 用户模拟

管理员能够模拟用户，以便重现用户报告的问题，测试他们的访问权限，确保他们能够访问预期的项目/问题/字段，或者为服务账户创建API令牌，用于授予其他系统对MantisBT的有限访问权。

## 修改用户密码

用户能够修改自己的密码（除非他们的账户是 "受保护 "的）。这可以通过点击 "我的账户"，然后在 "密码 "和 "确认密码 "字段中输入新的密码，然后点击 "更新用户 "来完成。更改密码会自动使所有登录的session失效，此时用户需要重新登录。

## 清理账户

清理功能允许删除超过一周前创建并从未登录过的用户账户。这对那些用无效的电子邮件注册的用户特别有用。管理员可以通过进入 "管理"，"用户"，并点击 "从未登录 "框内的 "清理账户 "按钮来进行清理。

## 角色权限

MantisBT使用角色来定义一个用户可以做什么。每个用户账户都有一个与之相关的全局或默认角色，用于与公共项目相关的所有操作，以及与特定项目无关的操作。角色小于`$g_private_project_threshold`的用户默认不能访问私人项目。

MantisBT默认角色是VIEWER、 REPORTER、UPDATER、DEVELOPER、MANAGER和ADMINISTRATOR。通过角色我们能很容易知道用户能否操作。例如，查看一个问题，报告一个问题，更新一个问题，添加一个注释等。

因为每个操作都会有一个最低能操作的阈值，并且这个阈值都是能配置的。例如，在报告问题的情况下，所需的访问级别可以通过`$g_report_bug_threshold`配置选项来配置（默认为REPORTER）。因此，为了让用户能够针对公共项目报告问题，该用户必须是大于或等于 REPORTER 的特定项目或全局角色。然而，在针对私人项目报告问题的情况下，用户必须是高于 REPORTER 的特定项目角色（针对该项目明确授予），或者是高于 `$g_private_project_threshold` 和 `$g_report_bug_threshold `的全局角色。

注意，项目特定的角色覆盖全局角色。例如，一个用户可能有REPORTER作为全局角色，但对一个特定项目有MANAGER角色。或者一个用户可以将MANAGER作为全局角色，由VIEWER访问一个特定的项目。公共和私人项目的角色都可以被覆盖。然而，对于拥有全局访问权限ADMINISTRATOR的用户，不允许覆盖访问级别。

每个功能通常有多个访问控制配置选项，以定义什么访问级别可以执行该操作。例如，添加注解可能需要 REPORTER 角色，更新注解可能需要 DEVELOPER 角色，除非该注解是由同一用户添加的。

这样的阈值配置选项可以被设置为单一的访问级别，这意味着具有这样的阈值及以上的用户被授权执行该操作。另一个选项是指定一个访问级别的数组，这表示具有明确的角色的用户被允许执行动作。

值得一提的是，角色是由`$g_access_levels_enum_string`配置选项定义的，而且有可能定制这样的列表。可用的访问级别的默认值是'10:查看者，25:记者，40:更新者，55:开发者，70:经理，90:管理员'。关于如何定制角色列表将在"自定义MantisBT"介绍。

## 生成用户

如果您使用的是全局用户目录（LDAP，Active Directory），您可能希望MantisBT能将已经存在于该目录中的用户能够被自动验证并加入MantisBT。

例如，一家公司可能会以这样的方式设置其MantisBT安装，即允许已经在其LDAP目录中注册的工作人员以相同的用户名和密码登录MantisBT。另一个选择是，如果MantisBT被集成到某些内容管理系统中，希望有一个单一的注册和单一的登录体验。

在这种情况下，一旦用户首次登录，就会自动为其创建一个用户账户，尽管密码验证仍然是根据LDAP或主要用户库进行的。

## 用户设置

用户可以通过修改他们的用户设置来自定义自己的MantisBT功能，以覆盖管理员设置的默认设置；管理员如果更改了默认的用户设置，并不会修改已有的用户设置，因为管理自己的首选项是用户的责任。

用户首选项包括以下内容：

- 默认项目：用户可以选择第一次登录时选择的默认项目。这可以是一个特定项目，也可以是“所有项目”。对于只处理一个项目的用户，可以将该项目设置为默认项目(而不是“所有项目”)。“查看问题”页面可以筛选你选择的项目。此外，任何新报告的问题都将与选择的项目相关联。
- 刷新延迟：刷新延迟用于指定查看问题页自动刷新的间隔秒数。
- 重定向延迟：重定向延迟是指在显示问题创建成功等闪烁消息后，用户被跳转到下一页之前等待的秒数。
- 笔记的排序顺序：在查看问题时或在电子邮件通知中，与笔记的排序有关的偏好。
- 关于XXX的电子邮件：如果不勾选，那么与相应事件相关的通知将被禁用。用户还可以指定发送电子邮件的最小问题严重程度。

​	请注意，该偏好仅用于禁用根据管理员的配置，该用户有资格接收的通知。

- 电子邮件备注限制：该偏好可用于限制包含在电子邮件通知中的问题备注的数量。在这里指定N将导致只包括最新的N。值为0意味着所有的注释都将被包括在内。
- 语言：用户的首选语言。该语言被用于GUI和电子邮件通知中。请注意，MantisBT使用UTF-8对数据进行编码，因此用户可以使用中文界面的MantisBT，而用德语记录问题数据。

## 用户描述文件

一个用户描述文件描述了他发现bug所在的环境配置。

在报告问题时，用户可以选择手动输入平台、操作系统和版本等信息，也可以从可用的描述文件列表中选择。

每个用户都可以访问他们创建的所有个人描述文件，此外还有全局描述文件；描述文件数据包括 "平台"、"操作系统"、"操作系统版本 "和 "附加说明"。

全局描述文件通常由管理员用来定义一套在其环境中使用的标准系统设置，这样就省去了用户单独定义的麻烦。管理全局描述文件所需的访问级别由`$g_manage_global_profile_threshold`配置选项来配置，默认为MANAGER。